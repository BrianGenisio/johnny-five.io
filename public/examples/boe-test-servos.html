<html>
<head>
  <meta charset="utf-8">
  <title>Johnny-Five</title>
  <meta name="description" content="Johnny-Five is an Open Source IoT and robotics programming framework">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="fonts" content="css/type.css">

  <script src="../js/fontloader.js" id="fontloader"></script>

  <link rel="stylesheet" href="../css/styles.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/default.min.css">
  <link href="favicon.ico" rel="icon">

</head>
<body>

  <div class="mast">
    <nav class="nav-primary wrapper icon-j5">

      <picture class="j5-icon">
        <source type="image/svg+xml" srcset="../img/js-logo.svg">
        <img src="../img/js-logo.png">
      </picture>

      <a href="/">Getting Started</a>
      <a href="/examples.html" class="current">Examples</a>
    </nav>

    <header role="banner" class="banner">
     <h1 class="site-hed">Examples</h1>
    </header>
  </div>

  <main class="central">
    <div class="wrap-a wrap-docs">

      <h1>Boe Test Servos</h1>
<p>Run with:</p>
<pre><code class="language-bash">node eg/boe-test-servos.js
</code></pre>
<pre><code class="language-javascript">var five = require(&quot;johnny-five&quot;),
  board, Navigator, bot, left, right, sonar, scanner, servos,
  expandWhich, reverseDirMap, scale;

reverseDirMap = {
  right: &quot;left&quot;,
  left: &quot;right&quot;
};

scale = function(speed, low, high) {
  return Math.floor(five.Fn.map(speed, 0, 5, low, high));
};


/**
 * Navigator
 * @param {Object} opts Optional properties object
 */

function Navigator(opts) {

  // Boe Navigator continuous are calibrated to stop at 90Â°
  this.center = opts.center || 90;

  this.servos = {
    right: new five.Servo({
      pin: opts.right,
      type: &quot;continuous&quot;
    }),
    left: new five.Servo({
      pin: opts.left,
      type: &quot;continuous&quot;
    })
  };

  this.direction = opts.direction || {
    right: this.center,
    left: this.center
  };

  this.speed = opts.speed == null ? 0 : opts.speed;

  this.history = [];
  this.which = &quot;forward&quot;;
  this.isTurning = false;

  setTimeout(function() {
    this.fwd(1).fwd(0);
  }.bind(this), 10);
}

/**
 * move
 * @param  {Number} right Speed/Direction of right servo
 * @param  {Number} left  Speed/Direction of left servo
 * @return {Object} this
 */
Navigator.prototype.move = function(right, left) {

  // Quietly ignore duplicate instructions
  if (this.direction.right === right &amp;&amp;
    this.direction.left === left) {
    return this;
  }

  // Servos are mounted opposite of each other,
  // the values for left and right will be in
  // opposing directions.
  this.servos.right.to(right);
  this.servos.left.to(left);

  // Store a recallable history of movement
  this.history.push({
    timestamp: Date.now(),
    right: right,
    left: left
  });

  // Update the stored direction state
  this.direction.right = right;
  this.direction.left = left;

  return this;
};


// TODO: DRY OUT!!!!!!!


/**
 * forward Move the bot forward
 * fwd Move the bot forward
 *
 * @param  {Number}0-5, 0 is stopped, 5 is fastest
 * @return {Object} this
 */
Navigator.prototype.forward = Navigator.prototype.fwd = function(speed) {
  speed = speed == null ? 1 : speed;

  var scaled = scale(speed, this.center, 110);

  this.speed = speed;
  this.which = &quot;forward&quot;;

  return this.to(this.center - (scaled - this.center), scaled);
};

/**
 * reverse Move the bot in reverse
 * rev Move the bot in reverse
 *
 * @param  {Number}0-5, 0 is stopped, 5 is fastest
 * @return {Object} this
 */
Navigator.prototype.reverse = Navigator.prototype.rev = function(speed) {
  speed = speed == null ? 1 : speed;

  var scaled = scale(speed, this.center, 110);

  this.speed = speed;
  this.which = &quot;reverse&quot;;

  console.log(scaled, this.center - (scaled - this.center));

  return this.to(scaled, this.center - (scaled - this.center));
};

/**
 * stop Stops the bot, regardless of current direction
 * @return {Object} this
 */
Navigator.prototype.stop = function() {
  this.speed = this.center;
  this.which = &quot;stop&quot;;

  return this.to(this.center, this.center);
};

/**
 * right Turn the bot right
 * @return {Object} this
 */

/**
 * left Turn the bot lefts
 * @return {Object} this
 */


[&quot;right&quot;, &quot;left&quot;].forEach(function(dir) {
  Navigator.prototype[dir] = function() {
    var actual = this.direction[reverseDirMap[dir]];

    if (!this.isTurning) {
      this.isTurning = true;
      this.to(actual, actual);

      // Restore direction after turn
      setTimeout(function() {

        this[this.which](this.speed);
        this.isTurning = false;

      }.bind(this), 750);
    }

    return this;
  };
});

expandWhich = function(which) {
  var parts, translations;

  translations = [{
    f: &quot;forward&quot;,
    r: &quot;reverse&quot;,
    fwd: &quot;forward&quot;,
    rev: &quot;reverse&quot;
  }, {
    r: &quot;right&quot;,
    l: &quot;left&quot;
  }];

  if (which.length === 2) {
    parts = [which[0], which[1]];
  }

  if (!parts.length &amp;&amp; /\-/.test(which)) {
    parts = which.split(&quot;-&quot;);
  }

  return parts.map(function(val, i) {
    return translations[i][val];
  }).join(&quot;-&quot;);
};

Navigator.prototype.pivot = function(which, time) {
  var actual, directions, scaled;

  scaled = scale(this.speed, this.center, 110);
  which = expandWhich(which);

  directions = {
    &quot;forward-right&quot;: function() {
      this.to(this.center, scaled);
    },
    &quot;forward-left&quot;: function() {
      this.to(this.center - (scaled - this.center), this.center);
    },
    &quot;reverse-right&quot;: function() {
      this.to(scaled, this.center);
    },
    &quot;reverse-left&quot;: function() {
      this.to(this.center, this.center - (scaled - this.center));
    }
  };

  directions[which].call(this, this.speed);

  setTimeout(function() {

    this[this.which](this.speed);

  }.bind(this), time || 1000);

  return this;
};


board = new five.Board();
board.on(&quot;ready&quot;, function() {

  sonar = new five.Sonar({
    pin: &quot;A2&quot;,
    freq: 100
  });
  sonar.on(&quot;change&quot;, function() {
    console.log(&quot;Object is &quot; + this.inches + &quot;inches away&quot;);
  });

  scanner = new five.Servo(12);
  scanner.sweep();

  this.repl.inject({
    // create a bot, right servo = pin 10, left servo = pin 11
    b: new Navigator({
      right: 10,
      left: 11
    })
  });
});

</code></pre>
<h2>License</h2>
<p>Copyright (c) 2012, 2013, 2014 Rick Waldron <a href="mailto:waldron.rick@gmail.com">waldron.rick@gmail.com</a>
Licensed under the MIT license.
Copyright (c) 2014, 2015 The Johnny-Five Contributors
Licensed under the MIT license.</p>


    </div>
  </main>

<script src="js/main.js"></script>
<script src="js/programs.json"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>
